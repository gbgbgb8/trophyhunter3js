<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Match Madness</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            margin: auto;
            background: #202020;
        }
    </style>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 360,
            height: 640,
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            backgroundColor: "#f4f4f4"
        };

        let board;
        let emojis = ['üçé', 'üçå', 'üçí', 'üçá', 'üçâ', 'üçç'];
        let selectedEmoji = null;
        let score = 0;
        let scoreText;

        function preload() {}

        function create() {
            board = [];
            for (let i = 0; i < 6; i++) {
                let row = [];
                for (let j = 0; j < 6; j++) {
                    let emoji = this.add.text(60 * j + 30, 60 * i + 150, Phaser.Math.RND.pick(emojis), {
                        fontSize: '32px'
                    }).setOrigin(0.5);
                    emoji.setInteractive();
                    emoji.on('pointerdown', function () {
                        if (selectedEmoji) {
                            if (Math.abs(selectedEmoji.x - emoji.x) + Math.abs(selectedEmoji.y - emoji.y) === 60) {
                                // Update board positions
                                let tempRow = board.indexOf(board.find(r => r.includes(selectedEmoji)));
                                let tempCol = board[tempRow].indexOf(selectedEmoji);
                                let newRow = board.indexOf(board.find(r => r.includes(emoji)));
                                let newCol = board[newRow].indexOf(emoji);

                                board[tempRow][tempCol] = emoji;
                                board[newRow][newCol] = selectedEmoji;

                                // Swap visuals
                                this.tweens.add({
                                    targets: selectedEmoji,
                                    x: emoji.x,
                                    y: emoji.y,
                                    duration: 200
                                });
                                this.tweens.add({
                                    targets: emoji,
                                    x: selectedEmoji.x,
                                    y: selectedEmoji.y,
                                    duration: 200,
                                    onComplete: () => {
                                        checkForMatches();
                                    }
                                });
                            }
                            selectedEmoji = null;
                        } else {
                            selectedEmoji = emoji;
                        }
                    }, this);
                    row.push(emoji);
                }
                board.push(row);
            }

            scoreText = this.add.text(10, 10, 'Score: 0', {
                fontSize: '20px',
                fill: '#000'
            });
        }

        function update() {}

        function checkForMatches() {
            let matches = [];
            for (let i = 0; i < 6; i++) {
                checkLineForMatch(board[i]);
            }

            for (let j = 0; j < 6; j++) {
                let column = [];
                for (let i = 0; i < 6; i++) {
                    column.push(board[i][j]);
                }
                checkLineForMatch(column);
            }

            function checkLineForMatch(line) {
                let matchCount = 1;
                for (let k = 1; k < 6; k++) {
                    if (line[k].text === line[k - 1].text) {
                        matchCount++;
                        if (matchCount >= 3 && k === 5) {
                            for (let l = 0; l < matchCount; l++) {
                                matches.push(line[k - l]);
                            }
                        }
                    } else {
                        if (matchCount >= 3) {
                            for (let l = 0; l < matchCount; l++) {
                                matches.push(line[k - l - 1]);
                            }
                        }
                        matchCount = 1;
                    }
                }
            }

            matches.forEach(emoji => {
                let col = board[0].indexOf(emoji);
                let row = board.indexOf(board.find(r => r.includes(emoji)));
                
                for (let i = row; i > 0; i--) {
                    board[i][col].setText(board[i - 1][col].text);
                }
                board[0][col].setText(Phaser.Math.RND.pick(emojis));
            });

            score += matches.length * 10;
            scoreText.setText('Score: ' + score);
        }

        new Phaser.Game(config);
    </script>
</body>

</html>
